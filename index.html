<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SNOW TIGER CAPITAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
    font-family: sans-serif;
}

#viewer {
    position: fixed;
    inset: 0;
    background: #000;
}

canvas, .linkLayer {
    position: absolute;
    top: 0;
    left: 0;
}

.linkLayer {
    pointer-events: none;
}

.linkLayer a {
    pointer-events: auto;
    position: absolute;
    border-bottom: 2px solid rgba(255,255,255,0.85);
}

.android-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
}

.android-img {
    width: 100%;
    height: auto;
    display: block;
}

.android-link {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 10;
}
</style>
</head>
<body>
<div id="viewer"></div>

<script type="module">
import * as pdfjsLib from './pdfjs/pdf.mjs';

const viewer = document.getElementById('viewer');
const ua = navigator.userAgent || navigator.vendor || window.opera;

// -------- Device detection --------
const isAndroid = /Android/i.test(ua);
const isAndroidFirefox = isAndroid && /Firefox/i.test(ua);
const isOtherAndroid = isAndroid && !/Firefox/i.test(ua);

// -------- Android Firefox redirect --------
if (isAndroidFirefox) {
    window.location.href = '/android-firefox.html';
}

// -------- Other Android (Chrome, Samsung, Firefox Focus) --------
else if (isOtherAndroid) {
    viewer.innerHTML = `
        <div class="android-wrapper">
            <img src="./document.png" class="android-img" alt="Document">
            <a href="https://ch1108677878.com" target="_blank" class="android-link"></a>
        </div>
    `;
}

// -------- Desktop + iPhone PDF.js --------
else {
    pdfjsLib.GlobalWorkerOptions.workerSrc = './pdfjs/pdf.worker.mjs';

    const canvas = document.createElement('canvas');
    const linkLayer = document.createElement('div');
    linkLayer.className = 'linkLayer';

    viewer.appendChild(canvas);
    viewer.appendChild(linkLayer);

    const ctx = canvas.getContext('2d');

    async function render() {
        const pdf = await pdfjsLib.getDocument('./document.pdf').promise;
        const page = await pdf.getPage(1);

        const baseViewport = page.getViewport({ scale: 1 });
        const scale = Math.min(
            window.innerWidth / baseViewport.width,
            window.innerHeight / baseViewport.height
        );

        const viewport = page.getViewport({ scale });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const offsetX = (window.innerWidth - viewport.width) / 2;
        const offsetY = (window.innerHeight - viewport.height) / 2;

        canvas.style.width = viewport.width + 'px';
        canvas.style.height = viewport.height + 'px';
        canvas.style.left = offsetX + 'px';
        canvas.style.top = offsetY + 'px';

        linkLayer.style.width = viewport.width + 'px';
        linkLayer.style.height = viewport.height + 'px';
        linkLayer.style.left = canvas.style.left;
        linkLayer.style.top = canvas.style.top;

        ctx.setTransform(1, 0, 0, 1, 0, 0);

        await page.render({
            canvasContext: ctx,
            viewport
        }).promise;

        linkLayer.innerHTML = '';
        const annotations = await page.getAnnotations();

        annotations.forEach(ann => {
            if (ann.subtype === 'Link' && ann.url) {
                const rect = pdfjsLib.Util.normalizeRect(ann.rect);
                const view = viewport.convertToViewportRectangle(rect);

                const a = document.createElement('a');
                a.href = ann.url;
                a.target = '_blank';

                a.style.left = Math.min(view[0], view[2]) + 'px';
                a.style.top = Math.min(view[1], view[3]) + 'px';
                a.style.width = Math.abs(view[2] - view[0]) + 'px';
                a.style.height = Math.abs(view[3] - view[1]) + 'px';

                linkLayer.appendChild(a);
            }
        });
    }

    render();
    window.addEventListener('resize', render);
}
</script>
</body>
</html>
