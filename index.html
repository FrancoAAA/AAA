<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SNOW TIGER CAPITAL</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
}

#viewer {
    position: fixed;
    inset: 0;
    background: #000;
}

/* DESKTOP CANVAS */
canvas, .linkLayer {
    position: absolute;
    top: 0;
    left: 0;
}

.linkLayer a {
    pointer-events: auto;
    position: absolute;
    display: block;
    background: rgba(255,255,255,0.12);
    border-bottom: 2px solid rgba(255,255,255,0.8);
    border-radius: 2px;
}

/* MOBILE PDF */
.mobile-frame {
    width: 100%;
    height: 100%;
    border: none;
    background: #000;
}

/* Rotate PDF for portrait mobile */
@media (orientation: portrait) {
    .rotate-landscape {
        position: absolute;
        width: 100vh;
        height: 100vw;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(90deg);
        transform-origin: center;
        background: #000;
    }
}
</style>
</head>

<body>
<div id="viewer"></div>

<script type="module">
import * as pdfjsLib from './pdfjs/pdf.mjs';

const PDF_URL = './document.pdf';
const viewer = document.getElementById('viewer');

const isMobile =
    /Android|iPhone|iPod|Mobi/i.test(navigator.userAgent);

/* =====================================================
   MOBILE: native PDF (iframe + object fallback)
   ===================================================== */
if (isMobile) {
    viewer.innerHTML = `
        <div class="rotate-landscape">
            <iframe
                class="mobile-frame"
                src="${PDF_URL}"
                title="PDF"
            ></iframe>
        </div>
    `;
}

/* =====================================================
   DESKTOP: PDF.js canvas with black background
   ===================================================== */
else {
    pdfjsLib.GlobalWorkerOptions.workerSrc = './pdfjs/pdf.worker.mjs';

    const canvas = document.createElement('canvas');
    const linkLayer = document.createElement('div');
    linkLayer.className = 'linkLayer';

    viewer.appendChild(canvas);
    viewer.appendChild(linkLayer);

    const ctx = canvas.getContext('2d');

    async function render() {
        const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
        const page = await pdf.getPage(1);

        const baseViewport = page.getViewport({ scale: 1 });

        const scale = Math.min(
            window.innerWidth / baseViewport.width,
            window.innerHeight / baseViewport.height
        );

        const dpr = window.devicePixelRatio || 1;
        const viewport = page.getViewport({ scale: scale * dpr });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const cssWidth = baseViewport.width * scale;
        const cssHeight = baseViewport.height * scale;

        const offsetX = (window.innerWidth - cssWidth) / 2;
        const offsetY = (window.innerHeight - cssHeight) / 2;

        canvas.style.width = cssWidth + 'px';
        canvas.style.height = cssHeight + 'px';
        canvas.style.left = offsetX + 'px';
        canvas.style.top = offsetY + 'px';

        linkLayer.style.width = cssWidth + 'px';
        linkLayer.style.height = cssHeight + 'px';
        linkLayer.style.left = offsetX + 'px';
        linkLayer.style.top = offsetY + 'px';

        // Fill canvas black BEFORE PDF rendering
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.setTransform(1, 0, 0, 1, 0, 0);

        await page.render({
            canvasContext: ctx,
            viewport: viewport,
            background: 'transparent'  // make PDF page itself transparent
        }).promise;

        // ---- LINK LAYER ----
        linkLayer.innerHTML = '';
        const annotations = await page.getAnnotations();

        annotations.forEach(ann => {
            if (ann.subtype === 'Link' && ann.url) {
                const rect = pdfjsLib.Util.normalizeRect(ann.rect);
                const view = viewport.convertToViewportRectangle(rect);

                const a = document.createElement('a');
                a.href = ann.url;
                a.target = '_blank';

                a.style.left = `${Math.min(view[0], view[2]) / dpr}px`;
                a.style.top = `${Math.min(view[1], view[3]) / dpr}px`;
                a.style.width = `${Math.abs(view[2] - view[0]) / dpr}px`;
                a.style.height = `${Math.abs(view[3] - view[1]) / dpr}px`;

                linkLayer.appendChild(a);
            }
        });
    }

    render();
    window.addEventListener('resize', render);
}
</script>
</body>
</html>
