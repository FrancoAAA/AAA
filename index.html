<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SNOW TIGER CAPITAL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
}

#viewer {
    position: fixed;
    inset: 0;
    background: #000;
}

/* ---------- ANDROID FIREFOX FALLBACK ---------- */
.android-firefox-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
}

.android-firefox-img {
    width: 100%;
    height: auto;
    display: block;
}

.android-firefox-link {
    position: absolute;
    left: 30%;
    top: 45%;
    width: 40%;
    height: 15%;
    z-index: 10;
}

/* ---------- PDF.JS ---------- */
canvas, .linkLayer {
    position: absolute;
    top: 0;
    left: 0;
}

.linkLayer {
    pointer-events: none;
}

.linkLayer a {
    pointer-events: auto;
    position: absolute;
}
</style>
</head>

<body>
<div id="viewer"></div>

<script type="module">
import * as pdfjsLib from './pdfjs/pdf.mjs';

const PDF_URL = './document.pdf';
const PNG_URL = './document.png';
const VITAL_LINK = 'https://YOUR-VITAL-LINK-HERE';

const viewer = document.getElementById('viewer');
const ua = navigator.userAgent;

/* =====================================================
   ANDROID FIREFOX ONLY → PNG FALLBACK
   ===================================================== */
const isAndroidFirefox =
    /Android/i.test(ua) &&
    /Firefox/i.test(ua) &&
    !/Focus/i.test(ua);

if (isAndroidFirefox) {
    viewer.innerHTML = `
        <div class="android-firefox-wrapper">
            <img src="${PNG_URL}" class="android-firefox-img" alt="Document">
            <a href="${VITAL_LINK}" target="_blank" class="android-firefox-link"></a>
        </div>
    `;
} else {
    /* =====================================================
       DESKTOP + iOS + EVERYTHING ELSE → PDF.JS
       (THIS IS YOUR ORIGINAL, WORKING LOGIC)
       ===================================================== */

    pdfjsLib.GlobalWorkerOptions.workerSrc = './pdfjs/pdf.worker.mjs';

    const canvas = document.createElement('canvas');
    const linkLayer = document.createElement('div');
    linkLayer.className = 'linkLayer';

    viewer.appendChild(canvas);
    viewer.appendChild(linkLayer);

    const ctx = canvas.getContext('2d');

    async function render() {
        const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
        const page = await pdf.getPage(1);

        const baseViewport = page.getViewport({ scale: 1 });

        const scale = Math.min(
            window.innerWidth / baseViewport.width,
            window.innerHeight / baseViewport.height
        );

        const viewport = page.getViewport({ scale });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        canvas.style.width = viewport.width + 'px';
        canvas.style.height = viewport.height + 'px';

        const offsetX = (window.innerWidth - viewport.width) / 2;
        const offsetY = (window.innerHeight - viewport.height) / 2;

        canvas.style.left = offsetX + 'px';
        canvas.style.top = offsetY + 'px';

        linkLayer.style.width = viewport.width + 'px';
        linkLayer.style.height = viewport.height + 'px';
        linkLayer.style.left = canvas.style.left;
        linkLayer.style.top = canvas.style.top;

        ctx.setTransform(1, 0, 0, 1, 0, 0);

        await page.render({
            canvasContext: ctx,
            viewport
        }).promise;

        linkLayer.innerHTML = '';
        const annotations = await page.getAnnotations();

        annotations.forEach(ann => {
            if (ann.subtype === 'Link' && ann.url) {
                const rect = pdfjsLib.Util.normalizeRect(ann.rect);
                const view = viewport.convertToViewportRectangle(rect);

                const a = document.createElement('a');
                a.href = ann.url;
                a.target = '_blank';

                a.style.left = Math.min(view[0], view[2]) + 'px';
                a.style.top = Math.min(view[1], view[3]) + 'px';
                a.style.width = Math.abs(view[2] - view[0]) + 'px';
                a.style.height = Math.abs(view[3] - view[1]) + 'px';

                linkLayer.appendChild(a);
            }
        });
    }

    render();
    window.addEventListener('resize', render);
}
</script>
</body>
</html>
